---
# Bootstrap blade
- name: Produce blade bootstrap script on the first validator
  ansible.builtin.template:
    src: bootstrap.sh
    dest: "{{ blade_home_dir }}/init.sh"
    mode: 0700
  when: hostvars[inventory_hostname].tags["Hostname"] == "validator-001"

- name: Produce blade secrets config file on the first validator
  ansible.builtin.template:
    src: config.json
    dest: "{{ blade_home_dir }}/config.json"
    mode: 0700
  when: hostvars[inventory_hostname].tags["Hostname"] == "validator-001"

- name: Execute bootstrap on the first validator
  ansible.builtin.shell: |
    {{ blade_home_dir }}/init.sh &> {{ blade_home_dir }}/bootstrap_output.txt
  when: hostvars[inventory_hostname].tags["Hostname"] == "validator-001"
  args:
    executable: /bin/bash

